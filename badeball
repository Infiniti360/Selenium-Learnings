Here is a complete, step-by-step guide to using the @badeball/cypress-cucumber-preprocessor plugin with Cypress plus handling file downloads â€” all with full setup and code examples.

â¸»

âœ… Goal:
	â€¢	Set up BDD (Cucumber) using @badeball/cypress-cucumber-preprocessor
	â€¢	Write a .feature file
	â€¢	Implement file download logic
	â€¢	Verify the file is downloaded or download it via request

â¸»

ðŸ§° Tech Stack
	â€¢	Cypress (v10+)
	â€¢	@badeball/cypress-cucumber-preprocessor
	â€¢	@bahmutov/cypress-esbuild-preprocessor
	â€¢	cypress-downloadfile plugin for file handling

â¸»

ðŸ“¦ Step 1: Install Required Packages

Run:

npm install --save-dev \
cypress \
@badeball/cypress-cucumber-preprocessor \
@bahmutov/cypress-esbuild-preprocessor \
esbuild \
cypress-downloadfile


â¸»

ðŸ“ Step 2: Project Folder Structure

project-root/
â”‚
â”œâ”€â”€ cypress/
â”‚   â”œâ”€â”€ e2e/
â”‚   â”‚   â”œâ”€â”€ features/
â”‚   â”‚   â”‚   â”œâ”€â”€ download.feature
â”‚   â”‚   â”‚   â””â”€â”€ downloadSteps.js
â”‚   â”œâ”€â”€ downloads/
â”‚   â””â”€â”€ support/
â”‚       â”œâ”€â”€ commands.js
â”‚       â””â”€â”€ e2e.js
â”‚
â”œâ”€â”€ cypress.config.js
â”œâ”€â”€ package.json


â¸»

âš™ï¸ Step 3: Cypress Configuration

cypress.config.js

const { defineConfig } = require("cypress");
const createBundler = require("@bahmutov/cypress-esbuild-preprocessor");
const createEsbuildPlugin = require("@badeball/cypress-cucumber-preprocessor/esbuild").createEsbuildPlugin;
const addCucumberPreprocessorPlugin = require("@badeball/cypress-cucumber-preprocessor").addCucumberPreprocessorPlugin;

module.exports = defineConfig({
  e2e: {
    specPattern: "cypress/e2e/features/**/*.feature",
    async setupNodeEvents(on, config) {
      await addCucumberPreprocessorPlugin(on, config);
      on(
        "file:preprocessor",
        createBundler({
          plugins: [createEsbuildPlugin(config)],
        })
      );
      return config;
    },
    baseUrl: "https://your-test-app.com", // replace with your actual base URL
  },
});


â¸»

ðŸ§  Step 4: Add Download Command

cypress/support/commands.js

import 'cypress-downloadfile/lib/downloadFileCommand';

cypress/support/e2e.js

import './commands';


â¸»

âœï¸ Step 5: Write the Feature File

cypress/e2e/features/download.feature

Feature: File download feature

  Scenario: Download a report file
    Given I visit the download page
    When I click the download button
    Then I should have the file downloaded


â¸»

ðŸ§ª Step 6: Step Definitions (JS Code)

cypress/e2e/features/downloadSteps.js

import { Given, When, Then } from "@badeball/cypress-cucumber-preprocessor";

Given("I visit the download page", () => {
  cy.visit("/downloads"); // adjust URL path
});

When("I click the download button", () => {
  // Option 1: trigger actual click
  cy.get("#downloadBtn").click();

  // Option 2: use request-based download
  // cy.downloadFile('https://your-test-app.com/files/sample.pdf', 'cypress/downloads', 'sample.pdf');
});

Then("I should have the file downloaded", () => {
  const filePath = "cypress/downloads/sample.pdf";
  cy.readFile(filePath, { timeout: 10000 }).should("exist");
});

âœ… Replace #downloadBtn and file URL/path as per your app.

â¸»

ðŸ“¥ Step 7: Download Button HTML (For Local Testing)

<!-- public/downloads.html -->
<button id="downloadBtn" onclick="window.location.href='/files/sample.pdf'">Download File</button>

Serve this locally or test against your appâ€™s download page.

â¸»

ðŸ§ª Step 8: Run Tests

npx cypress open   # for interactive mode
# or
npx cypress run    # headless run


â¸»

âœ… Summary of Whatâ€™s Set Up

Feature	Status
BDD with Cucumber (.feature)	âœ… Done
Plugin setup (badeball)	âœ… Done
File download handling	âœ… Done
Step definitions	âœ… Done
Download validation	âœ… Done
Folder/project layout	âœ… Done


â¸»

ðŸ’¡ Bonus Tips
	â€¢	To avoid flaky downloads, prefer direct API file download (cy.downloadFile()) over UI-triggered downloads.
	â€¢	Clean downloads folder before each test:

beforeEach(() => {
  cy.task('deleteDownloads'); // Create a custom task in `plugins/index.js` if needed
});



â¸»

Would you like:
	â€¢	A GitHub repo template with this structure already implemented?
	â€¢	An example using LangChain or ChatGPT downloads?

Let me know, and Iâ€™ll generate it for you!
